<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Login â€” TatiraLearning</title>

<style>

    body{
    background:#0a0f1c;
    color:white;
    font-family:Inter;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    }

    .container{
    background:#121a2b;
    padding:40px;
    border-radius:12px;
    width:320px;
    }

    input{
    width:100%;
    padding:12px;
    margin:10px 0;
    border:none;
    border-radius:8px;
    }

    button{
    width:100%;
    padding:12px;
    background:#00e5ff;
    border:none;
    border-radius:8px;
    cursor:pointer;
    }

    .error{color:#ff4d4d;}
    .success{color:#00ffae;}

    </style>
    </head>

    <body>

    <div class="container">

    <h2>Login</h2>

    <form id="login-form">

    <input id="username" placeholder="Username" required>

    <input id="password" type="password" placeholder="Password" required>

    <button type="submit">Login</button>

    <div id="message"></div>

    </form>

    </div>

    <script>

    const form = document.getElementById("login-form");

    form.addEventListener("submit", login);

    async function login(e){

    e.preventDefault();

    const username =
    document.getElementById("username").value;

    const password =
    document.getElementById("password").value;

    const message =
    document.getElementById("message");

    const response =
    await fetch("http://127.0.0.1:8000/api/login/", {

    method:"POST",

    headers:{
    "Content-Type":"application/json"
    },

    body:JSON.stringify({
    username,
    password
    })

    });

    const data = await response.json();

    if(response.ok){

    localStorage.setItem("access", data.access);

    localStorage.setItem("username", username);

    //////////////////////////////////////////////////
    // LOAD USER INFO
    //////////////////////////////////////////////////

    const userResponse =
    await fetch("http://127.0.0.1:8000/api/users/", {

    headers:{
    Authorization:
    "Bearer " + data.access
    }

    });

    if(userResponse.ok){

    localStorage.setItem("is_staff", "true");

    localStorage.setItem("is_superuser", "true");

    }

    message.innerHTML="Login successful";

    message.className="success";

    setTimeout(()=>{

    window.location.href="index.html";

    },1000);

    }else{

    message.innerHTML="Invalid login";

    message.className="error";

    }

    }

    </script>

    </body>
</html>