<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">
<title> Dashboard — TatiraLearning</title>

<style>

body{
background:#0a0f1c;
color:white;
font-family:Inter;
margin:0;
}

.navbar{
    background:#121a2b;
    padding:20px 40px;
    display:flex;
    justify-content:space-between;
}

.container{
    padding:40px;
    max-width:1000px;
    margin:auto;
    }
.card{
    background:#121a2b;
    padding:20px;
    margin-bottom:20px;
    border-radius:10px;
}

input, textarea{
width:100%;
padding:12px;
margin-top:10px;
border:none;
border-radius:6px;
}

button{
    margin-top:10px;
    padding:12px;
    background:#00e5ff;
    border:none;
    border-radius:6px;
    cursor:pointer;
}

.course{
    background:#16233f;
    padding:15px;
    margin-top:10px;
    border-radius:6px;
}

.success{color:#00ffae;}
.error{color:#ff4d4d;}

</style>

</head>

    <body>

    <div class="navbar">

    <div>
    Instructor Dashboard
    </div>

    <div>

    <span id="username"></span>

    <span onclick="logout()" style="cursor:pointer;color:red;">
    Logout
    </span>

    </div>

    </div>

    <div class="container">

    <div class="card">

    <h2>Create Course</h2>

    <form id="courseForm">

    <input id="title" placeholder="Title" required>

    <textarea id="description" placeholder="Description"></textarea>

    <input id="price" type="number" placeholder="Price">

    <button type="submit">Create</button>

    <div id="message"></div>

    </form>

    </div>

    <div class="card">

    <h2>Your Courses</h2>

    <div id="courses"></div>

    </div>

    </div>

    <script>

    const token = localStorage.getItem("access");

    if(!token){
    window.location.href="login.html";
    }

    document.getElementById("username").innerHTML =
    localStorage.getItem("username");

    function logout(){

    localStorage.clear();

    window.location.href="index.html";

    }

    //////////////////////////////////////////////////
    // LOAD COURSES
    //////////////////////////////////////////////////

    async function loadCourses(){

    const res =
    await fetch("http://127.0.0.1:8000/api/courses/",{
    headers:{
    Authorization:"Bearer "+token
    }
    });

    const data = await res.json();

    const container =
    document.getElementById("courses");

    container.innerHTML="";

    data.forEach(c=>{

    container.innerHTML+=`
    <div class="course">

    ${c.title}

    <br>

    €${c.price}

    </div>
    `;

    });

    }

    //////////////////////////////////////////////////
    // CREATE COURSE
    //////////////////////////////////////////////////

    document
    .getElementById("courseForm")
    .addEventListener("submit", async e=>{

    e.preventDefault();

    const title =
    document.getElementById("title").value;

    const description =
    document.getElementById("description").value;

    const price =
    document.getElementById("price").value;

    const res =
    await fetch("http://127.0.0.1:8000/api/courses/create/",{

    method:"POST",

    headers:{
    Authorization:"Bearer "+token,
    "Content-Type":"application/json"
    },

    body:JSON.stringify({
    title,
    description,
    price
    })

    });

    const msg =
    document.getElementById("message");

    if(res.ok){

    msg.innerHTML="Created";
    msg.className="success";

    loadCourses();

    }else{

    msg.innerHTML="Error";
    msg.className="error";

    }

    });

    loadCourses();

    </script>

    </body>
</html>